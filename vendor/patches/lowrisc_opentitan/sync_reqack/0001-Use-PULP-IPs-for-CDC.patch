From 10db3f5869c55b3c4cd56060962671e538ecf312 Mon Sep 17 00:00:00 2001
From: Michael Rogenmoser <michael@rogenmoser.us>
Date: Mon, 17 Jul 2023 19:41:32 +0200
Subject: [PATCH] Use PULP IPs for CDC

---
 prim_sync_reqack.sv | 54 ++++++++++++++++++++++++---------------------
 1 file changed, 29 insertions(+), 25 deletions(-)

diff --git a/prim_sync_reqack.sv b/prim_sync_reqack.sv
index 518546fae..af5898594 100644
--- a/prim_sync_reqack.sv
+++ b/prim_sync_reqack.sv
@@ -29,7 +29,7 @@
 // For further information, see Section 8.2.4 in H. Kaeslin, "Top-Down Digital VLSI Design: From
 // Architecture to Gate-Level Circuits and FPGAs", 2015.
 
-`include "prim_assert.sv"
+`include "common_cells/assertions.svh"
 
 module prim_sync_reqack #(
   parameter bit EnRstChks = 1'b0,   // Enable reset-related assertion checks, disabled by default.
@@ -103,13 +103,14 @@ module prim_sync_reqack #(
     end
 
     // Move ACK over to SRC domain.
-    prim_flop_2sync #(
-      .Width(1)
+    sync #(
+      .STAGES    (2),
+      .ResetValue('0)
     ) ack_sync (
-      .clk_i  (clk_src_i),
-      .rst_ni (rst_src_ni),
-      .d_i    (dst_ack),
-      .q_o    (src_ack)
+      .clk_i   (clk_src_i),
+      .rst_ni  (rst_src_ni),
+      .serial_i(dst_ack),
+      .serial_o(src_ack)
     );
 
     // Registers
@@ -155,13 +156,14 @@ module prim_sync_reqack #(
     end
 
     // Move REQ over to DST domain.
-    prim_flop_2sync #(
-      .Width(1)
+    sync #(
+      .STAGES    (2),
+      .ResetValue('0)
     ) req_sync (
-      .clk_i  (clk_dst_i),
-      .rst_ni (rst_dst_ni),
-      .d_i    (src_req),
-      .q_o    (dst_req)
+      .clk_i   (clk_dst_i),
+      .rst_ni  (rst_dst_ni),
+      .serial_i(src_req),
+      .serial_o(dst_req)
     );
 
     // Registers
@@ -195,23 +197,25 @@ module prim_sync_reqack #(
     assign dst_handshake = dst_req_o & dst_ack_i;
 
     // Move REQ over to DST domain.
-    prim_flop_2sync #(
-      .Width(1)
+    sync #(
+      .STAGES    (2),
+      .ResetValue('0)
     ) req_sync (
-      .clk_i  (clk_dst_i),
-      .rst_ni (rst_dst_ni),
-      .d_i    (src_req_q),
-      .q_o    (dst_req)
+      .clk_i   (clk_dst_i),
+      .rst_ni  (rst_dst_ni),
+      .serial_i(src_req_q),
+      .serial_o(dst_req)
     );
 
     // Move ACK over to SRC domain.
-    prim_flop_2sync #(
-      .Width(1)
+    sync #(
+      .STAGES    (2),
+      .ResetValue('0)
     ) ack_sync (
-      .clk_i  (clk_src_i),
-      .rst_ni (rst_src_ni),
-      .d_i    (dst_ack_q),
-      .q_o    (src_ack)
+      .clk_i   (clk_src_i),
+      .rst_ni  (rst_src_ni),
+      .serial_i(dst_ack_q),
+      .serial_o(src_ack)
     );
 
     // REQ-side FSM (SRC domain)
-- 
2.31.1

